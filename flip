#!/bin/bash
# flip - Flip an image horizontally while preserving metadata

if [ $# -ne 1 ]; then
    echo "Usage: flip /path/to/picture.jpg"
    exit 1
fi

# Get input file and details
INPUT="$1"
DIR="$(dirname "$INPUT")"
BASENAME="$(basename "$INPUT")"
EXT="${BASENAME##*.}"
NAME="${BASENAME%.*}"
OUTPUT="$DIR/${NAME}_flipped.$EXT"

# Flip image directly to output (pixels only)
convert "$INPUT" -flip "$OUTPUT"

# Copy ALL metadata (EXIF, IPTC, XMP, GPS, dates, etc.) from original
exiftool -overwrite_original \
    -TagsFromFile "$INPUT" \
    -all:all \
    -unsafe \
    "$OUTPUT" >/dev/null 2>&1

# Match the file system timestamps (created/modified) to original
touch -r "$INPUT" "$OUTPUT"

# Remove exiftool backup file if it appears
[ -f "${OUTPUT}_original" ] && rm -f "${OUTPUT}_original"

echo "Flipped image saved as: $OUTPUT"

